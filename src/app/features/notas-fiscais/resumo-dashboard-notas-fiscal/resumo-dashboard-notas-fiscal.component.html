<!-- src/app/features/notas-fiscais/resumo-dashboard-notas-fiscal/resumo-dashboard-notas-fiscal.component.html -->
<p-toast />

<div class="flex align-items-center gap-3 mb-4 p-3">
    <div class="icon-wrapper border-circle p-3 surface-card shadow-1 flex align-items-center justify-content-center">
        <i class="pi pi-chart-line text-primary text-5xl"></i>
    </div>
    <div class="flex flex-column">
        <h1 class="m-0 text-5xl font-bold text-900">Resumo Fiscal</h1>
        <p class="text-500 mt-1 mb-0">Visão geral das suas notas fiscais</p>
    </div>
</div>

<!-- Loading -->
<div *ngIf="loading" class="mb-3">
    <p-progressBar mode="indeterminate" [style]="{ height: '6px' }"></p-progressBar>
</div>

<div *ngIf="!loading">
    <!-- Cards de Métricas -->
    <div class="grid mb-4">
        <!-- Notas Emitidas -->
        <div class="col-12 md:col-6 lg:col-4">
            <p-card class="border-round-xl" [ngStyle]="{ position: 'relative', paddingLeft: '12px' }">
                <div [ngStyle]="{
                'position': 'absolute',
                'top': '0',
                'left': '0',
                'width': '6px',
                'height': '100%',
                'background': 'linear-gradient(to bottom, #10b981, rgba(16, 185, 129, 0.3))',
                'border-top-left-radius': '8px',
                'border-bottom-left-radius': '8px'
            }" class="absolute"></div>
                <div class="flex flex-column h-full">
                    <div class="flex justify-content-end">
                        <i class="pi pi-file text-teal-500 text-3xl opacity-80"></i>
                    </div>
                    <div class="text-900 text-2xl font-bold mb-1">{{ totalEmitidas }}</div>
                    <div class="text-600 mb-2">Notas Emitidas</div>
                    <div class="mt-auto flex justify-content-start">
                        <span class="text-green-600 font-medium text-xl">
                            {{ valorEmitido | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
                        </span>
                    </div>
                    <div class="mt-1 flex justify-content-start">
                        <p-badge value="Últimos 31 dias" severity="success" [size]="'large'" />
                    </div>
                </div>
            </p-card>
        </div>

        <!-- Notas Recebidas -->
        <div class="col-12 md:col-6 lg:col-4">
            <p-card class="border-round-xl" [ngStyle]="{ position: 'relative', paddingLeft: '12px' }">
                <div [ngStyle]="{
                'position': 'absolute',
                'top': '0',
                'left': '0',
                'width': '6px',
                'height': '100%',
                'background': 'linear-gradient(to bottom, #3b82f6, rgba(59, 130, 246, 0.3))',
                'border-top-left-radius': '8px',
                'border-bottom-left-radius': '8px'
            }" class="absolute"></div>
                <div class="flex flex-column h-full">
                    <div class="flex justify-content-end">
                        <i class="pi pi-download text-blue-500 text-3xl opacity-80"></i>
                    </div>
                    <div class="text-900 text-2xl font-bold mb-1">{{ totalRecebidas }}</div>
                    <div class="text-600 mb-2">Notas Recebidas</div>
                    <div class="mt-auto flex justify-content-start">
                        <span class="text-blue-600 font-medium text-xl">
                            {{ valorRecebido | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
                        </span>
                    </div>
                    <div class="mt-1 flex justify-content-start">
                        <p-badge value="Últimos 31 dias" severity="info" [size]="'large'" />
                    </div>
                </div>
            </p-card>
        </div>

        <!-- Botões de Ação -->
        <div class="col-12 md:col-6 lg:col-4">
            <p-card class="border-round-xl" [ngStyle]="{ position: 'relative', paddingLeft: '12px' }">
                <div [ngStyle]="{
                'position': 'absolute',
                'top': '0',
                'left': '0',
                'width': '6px',
                'height': '100%',
                'background': 'linear-gradient(to bottom, #8b5cf6, rgba(139, 92, 246, 0.3))',
                'border-top-left-radius': '8px',
                'border-bottom-left-radius': '8px'
            }" class="absolute"></div>
                <div class="flex flex-column h-full">
                    <div class="flex justify-content-end">
                        <i class="pi pi-arrow-right text-purple-500 text-3xl opacity-80"></i>
                    </div>
                    <div class="text-900 text-2xl font-bold mb-2">Navegar</div>
                    <div class="text-600 mb-3">Ações Rápidas</div>
                    <div class="mt-auto flex flex-row gap-3 justify-content-start">
                        <a routerLink="/notas-fiscais" class="no-underline w-auto">
                            <p-button label="Ver Emitidas" icon="pi pi-file" class="w-full" severity="success" />
                        </a>
                        <a routerLink="/notas-fiscais/recebidas" class="no-underline w-auto">
                            <p-button label="Ver Recebidas" icon="pi pi-download" class="w-full" severity="info" />
                        </a>
                    </div>
                </div>
            </p-card>
        </div>
    </div>

    <!-- Gráfico Comparativo - GRÁFICO DE LINHA COM VALORES EM R$ -->
    <div class="surface-card p-4 border-round-2xl shadow-1 mb-4">
        <h3 class="text-900 font-bold text-xl mb-3">
            <i class="pi pi-chart-line mr-2"></i>
            Evolução do Valor Emitido (Últimos 31 dias)
        </h3>
        <p class="text-500 mb-4">Acompanhe a evolução dos valores das notas fiscais emitidas</p>
        <div style="height: 350px; width: 100%;">
            <apx-chart [series]="chartOptions.series" [chart]="chartOptions.chart" [xaxis]="chartOptions.xaxis"
                [yaxis]="chartOptions.yaxis" [dataLabels]="chartOptions.dataLabels" [colors]="chartOptions.colors"
                [tooltip]="chartOptions.tooltip" [legend]="chartOptions.legend" [stroke]="chartOptions.stroke"
                [markers]="chartOptions.markers" [grid]="chartOptions.grid" [responsive]="chartOptions.responsive">
            </apx-chart>
        </div>
    </div>

    <!-- Últimas Notas Emitidas -->
    <div class="surface-card p-4 border-round-2xl shadow-1 mb-4">
        <div class="flex justify-content-between align-items-start mb-2">
            <h3 class="text-900 font-bold text-xl m-0">
                <i class="pi pi-file mr-2"></i>
                Últimas Notas Emitidas
            </h3>
            <a routerLink="/notas-fiscais" class="text-primary hover:underline">
                <span class="font-medium">Ver todas</span>
                <i class="pi pi-angle-right ml-1"></i>
            </a>
        </div>

        <div class="grid" *ngIf="notasEmitidas.length > 0; else semEmitidas">
            <div class="col-12 md:col-6 lg:col-4 xl:col-3 mb-3" *ngFor="let nota of (notasEmitidas | slice:0:4)">
                <div
                    class="surface-card p-3 border-round shadow-1 hover:shadow-2 transition-all transition-duration-300">
                    <div class="flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="text-500 text-sm block mb-1">Para:</span>
                            <span class="text-900 font-medium">{{ nota.cliente.razao_social }}</span>
                        </div>
                        <p-tag [value]="'Emitida'" />
                    </div>
                    <div class="text-2xl font-bold text-900 mb-2">{{ nota.valor_total |
                        currency:'BRL':'symbol':'1.2-2':'pt-BR' }}</div>
                    <div class="flex justify-content-between text-500 text-sm">
                        <span>{{ nota.data_criacao | date:'dd/MM/yyyy' }}</span>
                    </div>
                </div>
            </div>
        </div>

        <ng-template #semEmitidas>
            <div class="text-center py-6">
                <i class="pi pi-inbox text-400 text-6xl mb-3 block"></i>
                <span class="text-500">Nenhuma nota emitida nos últimos 31 dias</span>
            </div>
        </ng-template>
    </div>

    <!-- Últimas Notas Recebidas -->
    <div class="surface-card p-4 border-round-2xl shadow-1">
        <div class="flex justify-content-between align-items-start mb-2">
            <h3 class="text-900 font-bold text-xl m-0">
                <i class="pi pi-download mr-2"></i>
                Últimas Notas Recebidas
            </h3>
            <a routerLink="/notas-fiscais/recebidas" class="text-primary hover:underline">
                <span class="font-medium">Ver todas</span>
                <i class="pi pi-angle-right ml-1"></i>
            </a>
        </div>

        <div class="grid" *ngIf="notasRecebidas.length > 0; else semRecebidas">
            <div class="col-12 md:col-6 lg:col-4 xl:col-3 mb-3" *ngFor="let nota of (notasRecebidas | slice:0:4)">
                <div
                    class="surface-card p-3 border-round shadow-1 hover:shadow-2 transition-all transition-duration-300">
                    <div class="flex justify-content-between align-items-start mb-2">
                        <div>
                            <span class="text-500 text-sm block mb-1">De:</span>
                            <span class="text-900 font-medium truncate" style="max-width: 180px;">{{ nota.Nome_Prest
                                }}</span>
                        </div>
                        <p-tag [value]="nota.Status" [severity]="getStatusSeverityRecebida(nota.Status)" />
                    </div>
                    <div class="text-2xl font-bold text-900 mb-2">{{ parseValor(nota.Valor) |
                        currency:'BRL':'symbol':'1.2-2':'pt-BR' }}</div>
                    <div class="flex justify-content-between text-500 text-sm">
                        <span>{{ nota.Emissao }}</span>
                        <span>NFSe: {{ nota.NFSe }}</span>
                    </div>
                </div>
            </div>
        </div>

        <ng-template #semRecebidas>
            <div class="text-center py-6">
                <i class="pi pi-inbox text-400 text-6xl mb-3 block"></i>
                <span class="text-500">Nenhuma nota recebida nos últimos 31 dias</span>
            </div>
        </ng-template>
    </div>
</div>